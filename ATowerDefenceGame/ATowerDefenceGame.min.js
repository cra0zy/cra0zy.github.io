Bridge.assembly("ATowerDefenceGame",function($asm,globals){"use strict";Bridge.define("ATowerDefenceGame.App",{main:function(){var divdata=document.createElement("div"),button,brelem,canvas;divdata.innerHTML="This is an example web game for MonoGame, it just uses a prototy that @Jjagg and me made in like 3h for a gamejam, and than didn't have the time to finish it...<br><br>Once in game press space to spawn enemies.<br><br>Green screen means that the game is loading, I didn't want to bother implementing a custom loading screen.<br><br>";document.body.appendChild(divdata);button=document.createElement("button");button.innerHTML="Run Game";divdata.appendChild(button);brelem=document.createElement("br");document.body.appendChild(brelem);canvas=document.createElement("canvas");canvas.width=1024;canvas.height=576;canvas.id="monogamecanvas";document.body.appendChild(canvas);button.onclick=function(ev){ATowerDefenceGame.App.game=new ATowerDefenceGame.Game1;ATowerDefenceGame.App.game.Run();document.body.removeChild(divdata);document.body.removeChild(brelem)}},statics:{fields:{game:null}}});Bridge.define("ATowerDefenceGame.ILevel",{fields:{BackgroundColor:null,Objects:null,BackgroundObjects:null},ctors:{init:function(){this.BackgroundColor=new Microsoft.Xna.Framework.Color},ctor:function(){this.$initialize();this.Objects=new(ATowerDefenceGame.Util.SafeList$1(ATowerDefenceGame.IObject));this.BackgroundObjects=new(ATowerDefenceGame.Util.SafeList$1(ATowerDefenceGame.IObject))}},methods:{Update:function(gameTime){var $t,$t1,obj,obj1;$t=Bridge.getEnumerator(this.BackgroundObjects);try{while($t.moveNext())obj=$t.Current,obj.Update(gameTime)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}$t1=Bridge.getEnumerator(this.Objects);try{while($t1.moveNext())obj1=$t1.Current,obj1.Update(gameTime)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}this.BackgroundObjects.Commit();this.Objects.Commit()},BeforeDraw:function(gameTime,spriteBatch){var $t,obj;$t=Bridge.getEnumerator(this.BackgroundObjects);try{while($t.moveNext())obj=$t.Current,obj.Draw(gameTime,spriteBatch)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Draw:function(gameTime,spriteBatch){var $t,obj;$t=Bridge.getEnumerator(this.Objects);try{while($t.moveNext())obj=$t.Current,obj.Draw(gameTime,spriteBatch)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}}}});Bridge.define("ATowerDefenceGame.Circle",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new ATowerDefenceGame.Circle}}},fields:{Position:null,Radius:0},ctors:{init:function(){this.Position=new Microsoft.Xna.Framework.Vector2},$ctor1:function(position,radius){this.$initialize();this.Position=position.$clone();this.Radius=radius},ctor:function(){this.$initialize()}},methods:{Offset:function(dp){return new ATowerDefenceGame.Circle.$ctor1(Microsoft.Xna.Framework.Vector2.op_Addition(this.Position.$clone(),dp.$clone()),this.Radius)},Sample:function(){var r=this.Radius*Math.sqrt(ATowerDefenceGame.RngGenerator.GetFloat()),phi=Microsoft.Xna.Framework.MathHelper.TwoPi*ATowerDefenceGame.RngGenerator.GetFloat();return Microsoft.Xna.Framework.Vector2.op_Addition(this.Position.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(r*Math.cos(phi),r*Math.sin(phi)))},Overlaps:function(other){return Microsoft.Xna.Framework.Vector2.Distance(this.Position.$clone(),other.Position.$clone())<this.Radius+other.Radius},getHashCode:function(){return Bridge.addHash([1668468399,this.Position,this.Radius])},equals:function(o){return Bridge.is(o,ATowerDefenceGame.Circle)?Bridge.equals(this.Position,o.Position)&&Bridge.equals(this.Radius,o.Radius):!1},$clone:function(to){var s=to||new ATowerDefenceGame.Circle;return s.Position=this.Position.$clone(),s.Radius=this.Radius,s}}});Bridge.define("ATowerDefenceGame.CursorType",{$kind:"enum",statics:{fields:{None:0,Pointer:1,Wand:2}}});Bridge.define("ATowerDefenceGame.IObject",{methods:{Update:function(gameTime){},Draw:function(gameTime,spriteBatch){}}});Bridge.define("ATowerDefenceGame.EnemyState",{$kind:"enum",statics:{fields:{Walking:0,Attacking:1}}});Bridge.define("ATowerDefenceGame.Extensions",{statics:{methods:{DrawRectangle:function(spriteBatch,rec,color){spriteBatch.Draw(ATowerDefenceGame.GameContent.Texture.Pixel,rec.$clone(),color.$clone())},GetAngle:function(v){return Math.atan2(v.Y,v.X)}}}});Bridge.define("ATowerDefenceGame.Game1",{inherits:[Microsoft.Xna.Framework.Game],statics:{fields:{Instance:null}},fields:{graphics:null,spriteBatch:null,rasterizerState:null},ctors:{ctor:function(){this.$initialize();Microsoft.Xna.Framework.Game.ctor.call(this);ATowerDefenceGame.Game1.Instance=this;this.graphics=new Microsoft.Xna.Framework.GraphicsDeviceManager(this);this.graphics.PreferMultiSampling=!0;this.graphics.PreferredBackBufferWidth=ATowerDefenceGame.GameSettings.BaseWidth;this.graphics.PreferredBackBufferHeight=ATowerDefenceGame.GameSettings.BaseHeight;this.graphics.HardwareModeSwitch=!1;this.rasterizerState=new Microsoft.Xna.Framework.Graphics.RasterizerState.ctor;this.rasterizerState.MultiSampleAntiAlias=!0;this.Content.RootDirectory="Content";this.IsMouseVisible=!0}},methods:{Initialize:function(){this.Window.Title="A Tower Defence Game";Microsoft.Xna.Framework.Game.prototype.Initialize.call(this)},LoadContent:function(){var $step=0,$jumpFromFinally,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0],$step);switch($step){case 0:this.spriteBatch=new Microsoft.Xna.Framework.Graphics.SpriteBatch(this.GraphicsDevice);ATowerDefenceGame.GameContent.Init(this.Content,this.GraphicsDevice);ATowerDefenceGame.GameSettings.Init(this.graphics);ATowerDefenceGame.LevelManager.Init(this.graphics);ATowerDefenceGame.LevelManager.LoadLevel(new ATowerDefenceGame.BootLevel(this.GraphicsDevice),!1);return;default:return}}},arguments);$asyncBody()},Update:function(gameTime){ATowerDefenceGame.GameContent.IsLoaded&&(Microsoft.Xna.Framework.Input.Keyboard.GetState().IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Escape)&&this.Exit(),ATowerDefenceGame.InputManager.Update(),ATowerDefenceGame.LevelManager.Update(gameTime),Microsoft.Xna.Framework.Game.prototype.Update.call(this,gameTime))},Draw:function(gameTime){if(!ATowerDefenceGame.GameContent.IsLoaded){this.GraphicsDevice.Clear(Microsoft.Xna.Framework.Color.DarkGreen.$clone());return}this.GraphicsDevice.Clear(ATowerDefenceGame.LevelManager.BackgroundColor.$clone());ATowerDefenceGame.LevelManager.Draw(gameTime,this.spriteBatch);this.spriteBatch.Begin(0,void 0,void 0,void 0,this.rasterizerState,void 0,void 0);this.spriteBatch.Draw$1(ATowerDefenceGame.LevelManager.ScreenSpace,new Microsoft.Xna.Framework.Rectangle.$ctor2(0,0,this.Window.ClientBounds.Width,this.Window.ClientBounds.Height),null,Microsoft.Xna.Framework.Color.White.$clone());this.spriteBatch.End();Microsoft.Xna.Framework.Game.prototype.Draw.call(this,gameTime)}}});Bridge.define("ATowerDefenceGame.GameContent",{statics:{fields:{IsLoaded:!1},methods:{Init:function(content,graphics){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$taskResult3,$task4,$taskResult4,$task5,$taskResult5,$task6,$taskResult6,$task7,$taskResult7,$task8,$taskResult8,$task9,$taskResult9,$task10,$taskResult10,$jumpFromFinally,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1,2,3,4,5,6,7,8,9,10],$step);switch($step){case 0:$task1=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Pixel.png");$step=1;$task1.continueWith($asyncBody,!0);return;case 1:$taskResult1=$task1.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Pixel=$taskResult1;$task2=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Tower.png");$step=2;$task2.continueWith($asyncBody,!0);return;case 2:$taskResult2=$task2.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Tower=$taskResult2;$task3=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/EnemyKnight.png");$step=3;$task3.continueWith($asyncBody,!0);return;case 3:$taskResult3=$task3.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.EnemyKnight=$taskResult3;$task4=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Fireball.png");$step=4;$task4.continueWith($asyncBody,!0);return;case 4:$taskResult4=$task4.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Fireball=$taskResult4;$task5=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Wizard.png");$step=5;$task5.continueWith($asyncBody,!0);return;case 5:$taskResult5=$task5.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Wizard=$taskResult5;$task6=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Ground.png");$step=6;$task6.continueWith($asyncBody,!0);return;case 6:$taskResult6=$task6.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Ground=$taskResult6;$task7=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Wand.png");$step=7;$task7.continueWith($asyncBody,!0);return;case 7:$taskResult7=$task7.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Wand=$taskResult7;$task8=Microsoft.Xna.Framework.Graphics.Texture2D.FromURL(graphics,"Content/Textures/Pointer.png");$step=8;$task8.continueWith($asyncBody,!0);return;case 8:$taskResult8=$task8.getAwaitedResult();ATowerDefenceGame.GameContent.Texture.Pointer=$taskResult8;$task9=content.LoadAsync(Microsoft.Xna.Framework.Graphics.SpriteFont,"Fonts/IntroFont");$step=9;$task9.continueWith($asyncBody,!0);return;case 9:$taskResult9=$task9.getAwaitedResult();ATowerDefenceGame.GameContent.Font.IntroFont=$taskResult9;ATowerDefenceGame.GameContent.Font.IntroFontSize=ATowerDefenceGame.GameContent.Font.IntroFont.MeasureString("M").Y+ATowerDefenceGame.GameContent.Font.IntroFont.Spacing;$task10=content.LoadAsync(Microsoft.Xna.Framework.Graphics.SpriteFont,"Fonts/TitleFont");$step=10;$task10.continueWith($asyncBody,!0);return;case 10:$taskResult10=$task10.getAwaitedResult();ATowerDefenceGame.GameContent.Font.TitleFont=$taskResult10;ATowerDefenceGame.GameContent.IsLoaded=!0;return;default:return}}},arguments);$asyncBody()}}}});Bridge.define("ATowerDefenceGame.GameContent.Font",{$kind:"nested class",statics:{fields:{IntroFont:null,IntroFontSize:0,TitleFont:null}}});Bridge.define("ATowerDefenceGame.GameContent.Texture",{$kind:"nested class",statics:{fields:{Pixel:null,Tower:null,EnemyKnight:null,Fireball:null,Wizard:null,Ground:null,Wand:null,Pointer:null}}});Bridge.define("ATowerDefenceGame.GameSettings",{statics:{fields:{BaseWidth:0,BaseHeight:0,FloorLevel:0,GDManager:null,_cursorPointer:null,_cursorWand:null},ctors:{init:function(){this.BaseWidth=1024;this.BaseHeight=576;this.FloorLevel=480}},methods:{Init:function(graphicsDeviceManager){ATowerDefenceGame.GameSettings.GDManager=graphicsDeviceManager},SetCursor:function(type){}}}});Bridge.define("ATowerDefenceGame.InputManager",{statics:{fields:{KeyState:null,PrevKeyState:null,MouseState:null,PrevMouseState:null},props:{MousePosition:{get:function(){return new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.div(Bridge.Int.mul(ATowerDefenceGame.InputManager.MouseState.X,ATowerDefenceGame.GameSettings.BaseWidth),ATowerDefenceGame.GameSettings.GDManager.GraphicsDevice.PresentationParameters.BackBufferWidth)|0,Bridge.Int.div(Bridge.Int.mul(ATowerDefenceGame.InputManager.MouseState.Y,ATowerDefenceGame.GameSettings.BaseHeight),ATowerDefenceGame.GameSettings.GDManager.GraphicsDevice.PresentationParameters.BackBufferHeight)|0)}}},ctors:{init:function(){this.KeyState=new Microsoft.Xna.Framework.Input.KeyboardState;this.PrevKeyState=new Microsoft.Xna.Framework.Input.KeyboardState;this.MouseState=new Microsoft.Xna.Framework.Input.MouseState;this.PrevMouseState=new Microsoft.Xna.Framework.Input.MouseState}},methods:{Update:function(){ATowerDefenceGame.InputManager.PrevKeyState=ATowerDefenceGame.InputManager.KeyState.$clone();ATowerDefenceGame.InputManager.KeyState=Microsoft.Xna.Framework.Input.Keyboard.GetState();ATowerDefenceGame.InputManager.PrevMouseState=ATowerDefenceGame.InputManager.MouseState.$clone();ATowerDefenceGame.InputManager.MouseState=Microsoft.Xna.Framework.Input.Mouse.GetState()},KeyPressed:function(key){return ATowerDefenceGame.InputManager.PrevKeyState.IsKeyUp(key)&&ATowerDefenceGame.InputManager.KeyState.IsKeyDown(key)},MousePressed:function(){return ATowerDefenceGame.InputManager.PrevMouseState.LeftButton===Microsoft.Xna.Framework.Input.ButtonState.Released&&ATowerDefenceGame.InputManager.MouseState.LeftButton===Microsoft.Xna.Framework.Input.ButtonState.Pressed}}}});Bridge.define("ATowerDefenceGame.LevelManager",{statics:{fields:{_screens:null,_currentLevel:null,_levelChanging:!1,_transition:!1,_alpha:0,_graphicsDeviceManager:null},props:{BackgroundColor:{get:function(){return ATowerDefenceGame.LevelManager._currentLevel.BackgroundColor.$clone()}},ScreenSpace:{get:function(){return ATowerDefenceGame.LevelManager._screens[System.Array.index(0,ATowerDefenceGame.LevelManager._screens)]}}},methods:{Init:function(graphicsDeviceManager){ATowerDefenceGame.LevelManager._graphicsDeviceManager=graphicsDeviceManager;ATowerDefenceGame.LevelManager._screens=System.Array.init(2,null,Microsoft.Xna.Framework.Graphics.RenderTarget2D);ATowerDefenceGame.LevelManager._screens[System.Array.index(0,ATowerDefenceGame.LevelManager._screens)]=new Microsoft.Xna.Framework.Graphics.RenderTarget2D.ctor(graphicsDeviceManager.GraphicsDevice,ATowerDefenceGame.GameSettings.BaseWidth,ATowerDefenceGame.GameSettings.BaseHeight)},LoadLevel:function(level,transition){transition===void 0&&(transition=!0);ATowerDefenceGame.LevelManager._levelChanging=!0;ATowerDefenceGame.LevelManager._screens[System.Array.index(1,ATowerDefenceGame.LevelManager._screens)]=ATowerDefenceGame.LevelManager._screens[System.Array.index(0,ATowerDefenceGame.LevelManager._screens)];ATowerDefenceGame.LevelManager._screens[System.Array.index(0,ATowerDefenceGame.LevelManager._screens)]=new Microsoft.Xna.Framework.Graphics.RenderTarget2D.ctor(ATowerDefenceGame.LevelManager._graphicsDeviceManager.GraphicsDevice,ATowerDefenceGame.GameSettings.BaseWidth,ATowerDefenceGame.GameSettings.BaseHeight);ATowerDefenceGame.LevelManager._transition=transition;ATowerDefenceGame.LevelManager._alpha=1;ATowerDefenceGame.LevelManager._currentLevel=level;ATowerDefenceGame.LevelManager._levelChanging=!1},Update:function(gameTime){ATowerDefenceGame.LevelManager._levelChanging||ATowerDefenceGame.LevelManager._currentLevel.Update(gameTime)},Draw:function(gameTime,spriteBatch){ATowerDefenceGame.LevelManager._levelChanging||(ATowerDefenceGame.LevelManager._graphicsDeviceManager.GraphicsDevice.SetRenderTarget(ATowerDefenceGame.LevelManager._screens[System.Array.index(0,ATowerDefenceGame.LevelManager._screens)]),ATowerDefenceGame.LevelManager._graphicsDeviceManager.GraphicsDevice.Clear(ATowerDefenceGame.LevelManager.BackgroundColor.$clone()),spriteBatch.Begin(0,void 0,Microsoft.Xna.Framework.Graphics.SamplerState.PointClamp,void 0,void 0,void 0,void 0),ATowerDefenceGame.LevelManager._currentLevel.BeforeDraw(gameTime,spriteBatch),ATowerDefenceGame.LevelManager._currentLevel.Draw(gameTime,spriteBatch),ATowerDefenceGame.LevelManager._transition&&(spriteBatch.Draw$3(ATowerDefenceGame.LevelManager._screens[System.Array.index(1,ATowerDefenceGame.LevelManager._screens)],Microsoft.Xna.Framework.Vector2.Zero.$clone(),Microsoft.Xna.Framework.Color.op_Multiply(Microsoft.Xna.Framework.Color.White.$clone(),ATowerDefenceGame.LevelManager._alpha)),ATowerDefenceGame.LevelManager._alpha-=gameTime.ElapsedGameTime.getTotalSeconds(),ATowerDefenceGame.LevelManager._alpha<=0&&(ATowerDefenceGame.LevelManager._transition=!1)),spriteBatch.End(),ATowerDefenceGame.LevelManager._graphicsDeviceManager.GraphicsDevice.SetRenderTarget(null))}}}});Bridge.define("ATowerDefenceGame.RngGenerator",{statics:{methods:{GetFloat:function(){return ATowerDefenceGame.RngGenerator.GetUInt32()%100/100},GetUInt32:function(){return(new System.Random.ctor).Next()>>>0},GetBool:function(){return(new System.Random.ctor).Next()%2==0}}}});Bridge.define("ATowerDefenceGame.Util.SafeList$1",function(T){return{inherits:[System.Collections.Generic.IEnumerable$1(T)],fields:{List:null,Added:null,Removed:null},alias:["GetEnumerator",["System$Collections$Generic$IEnumerable$1$"+Bridge.getTypeAlias(T)+"$GetEnumerator","System$Collections$Generic$IEnumerable$1$GetEnumerator"]],ctors:{ctor:function(){this.$initialize();this.List=new(System.Collections.Generic.List$1(T).ctor);this.Added=new(System.Collections.Generic.List$1(T).ctor);this.Removed=new(System.Collections.Generic.List$1(T).ctor)}},methods:{Add:function(obj){this.Added.add(obj)},Remove:function(obj){this.Removed.add(obj)},Commit:function(){var $t,$t1,obj,obj1;if(System.Linq.Enumerable.from(this.Added).any()){$t=Bridge.getEnumerator(this.Added);try{while($t.moveNext())obj=$t.Current,this.List.add(obj)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}this.Added.clear()}if(System.Linq.Enumerable.from(this.Removed).any()){$t1=Bridge.getEnumerator(this.Removed);try{while($t1.moveNext())obj1=$t1.Current,this.List.remove(obj1)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}this.Removed.clear()}},GetEnumerator:function(){return this.List.GetEnumerator().$clone()},System$Collections$IEnumerable$GetEnumerator:function(){return this.GetEnumerator()}}}});Bridge.define("ATowerDefenceGame.BootLevel",{inherits:[ATowerDefenceGame.ILevel],fields:{_lines:null,_index:0,_waittinme:0,_graphicsDevice:null},ctors:{init:function(){this._lines=System.Array.init(["Once upon time...","                                                                 in a land far away","                                                         there lived a princess","       who got kidnapped","                  and you are the bastard who did it!"],System.String)},ctor:function(graphicsDevice){this.$initialize();ATowerDefenceGame.ILevel.ctor.call(this);ATowerDefenceGame.GameSettings.SetCursor(ATowerDefenceGame.CursorType.None);this.BackgroundColor=Microsoft.Xna.Framework.Color.Black.$clone();this._waittinme=1.5;this._index=0;this._graphicsDevice=graphicsDevice}},methods:{Update:function(gameTime){var $t,y;if((ATowerDefenceGame.InputManager.KeyPressed(Microsoft.Xna.Framework.Input.Keys.Space)||this._waittinme>2)&&this._index<=this._lines.length){if(this._index===this._lines.length){ATowerDefenceGame.LevelManager.LoadLevel(new ATowerDefenceGame.MenuLevel);return}y=ATowerDefenceGame.GameContent.Font.IntroFontSize*2*this._index;this.Objects.Add(($t=new ATowerDefenceGame.FadeInText(this._lines[System.Array.index(this._index,this._lines)]),$t.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(16,y),$t));this._waittinme=0;this._index=this._index+1|0}this._waittinme+=gameTime.ElapsedGameTime.getTotalSeconds();ATowerDefenceGame.ILevel.prototype.Update.call(this,gameTime)}}});Bridge.define("ATowerDefenceGame.EndLevel",{inherits:[ATowerDefenceGame.ILevel],fields:{_index:0,_waittinme:0},ctors:{ctor:function(){this.$initialize();ATowerDefenceGame.ILevel.ctor.call(this);ATowerDefenceGame.GameSettings.SetCursor(ATowerDefenceGame.CursorType.None);this.BackgroundColor=Microsoft.Xna.Framework.Color.Black.$clone();this._waittinme=1;this._index=0}},methods:{Update:function(gameTime){ATowerDefenceGame.ILevel.prototype.Update.call(this,gameTime)}}});Bridge.define("ATowerDefenceGame.Enemy",{inherits:[ATowerDefenceGame.IObject],fields:{Origin:null,Radius:0,Position:null,MaxHealth:0,Health:0},props:{Bounding:{get:function(){return new ATowerDefenceGame.Circle.$ctor1(this.Position.$clone(),this.Radius)}},Dead:{get:function(){return this.Health<0}}},ctors:{init:function(){this.Origin=new Microsoft.Xna.Framework.Vector2;this.Position=new Microsoft.Xna.Framework.Vector2},ctor:function(maxHealth){this.$initialize();ATowerDefenceGame.IObject.ctor.call(this);this.MaxHealth=maxHealth;this.Health=this.MaxHealth}}});Bridge.define("ATowerDefenceGame.FadeInText",{inherits:[ATowerDefenceGame.IObject],fields:{_alpha:0,_text:null,Position:null},ctors:{init:function(){this.Position=new Microsoft.Xna.Framework.Vector2},ctor:function(text){this.$initialize();ATowerDefenceGame.IObject.ctor.call(this);this._alpha=0;this._text=text;this.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(16,16)}},methods:{Draw:function(gameTime,spriteBatch){this._alpha<1&&(this._alpha+=gameTime.ElapsedGameTime.getTotalSeconds());spriteBatch.DrawString(ATowerDefenceGame.GameContent.Font.IntroFont,this._text,this.Position.$clone(),Microsoft.Xna.Framework.Color.op_Multiply(Microsoft.Xna.Framework.Color.White.$clone(),this._alpha))}}});Bridge.define("ATowerDefenceGame.Projectile",{inherits:[ATowerDefenceGame.IObject],fields:{Damage:0,Speed:null,Position:null,Texture:null,Destroyed:!1},props:{Bounding:{get:function(){return new ATowerDefenceGame.Circle.$ctor1(this.Position.$clone(),this.Radius)}},Top:{get:function(){return this.Position.Y-this.Origin.Y}},Bottom:{get:function(){return this.Position.Y+this.Origin.Y}},Left:{get:function(){return this.Position.X-this.Origin.X}},Right:{get:function(){return this.Position.X+this.Origin.X}}},ctors:{init:function(){this.Speed=new Microsoft.Xna.Framework.Vector2;this.Position=new Microsoft.Xna.Framework.Vector2},ctor:function(position,texture){this.$initialize();ATowerDefenceGame.IObject.ctor.call(this);this.Position=position.$clone();this.Texture=texture}},methods:{Hit:function(enemy){enemy.Health-=this.Damage;this.Destroyed=!0},Update:function(gameTime){var dt=gameTime.ElapsedGameTime.getTotalSeconds();this.Position=Microsoft.Xna.Framework.Vector2.op_Addition(this.Position.$clone(),Microsoft.Xna.Framework.Vector2.op_Multiply$2(dt,this.Speed.$clone()));this.IsOffscreen()&&(this.Destroyed=!0)},IsOffscreen:function(){return(this.Bottom<0||this.Top>ATowerDefenceGame.GameSettings.BaseHeight)&&(this.Right<0||this.Left>ATowerDefenceGame.GameSettings.BaseWidth)},Draw:function(gameTime,spriteBatch){var rot=ATowerDefenceGame.Extensions.GetAngle(this.Speed);spriteBatch.Draw$5(this.Texture,this.Position.$clone(),null,Microsoft.Xna.Framework.Color.White.$clone(),rot,this.Origin.$clone(),Microsoft.Xna.Framework.Vector2.One.$clone(),Microsoft.Xna.Framework.Graphics.SpriteEffects.None,0)}}});Bridge.define("ATowerDefenceGame.GameLevel",{inherits:[ATowerDefenceGame.ILevel],statics:{fields:{ProjectileCircleRadius:0},ctors:{init:function(){this.ProjectileCircleRadius=30}}},fields:{_wizard:null,Enemies:null,Projectiles:null},ctors:{ctor:function(){var $t,x,y;for(this.$initialize(),ATowerDefenceGame.ILevel.ctor.call(this),ATowerDefenceGame.GameSettings.SetCursor(ATowerDefenceGame.CursorType.Wand),this.BackgroundColor=Microsoft.Xna.Framework.Color.LightBlue.$clone(),this.Enemies=new(ATowerDefenceGame.Util.SafeList$1(ATowerDefenceGame.Enemy)),this.Projectiles=new(ATowerDefenceGame.Util.SafeList$1(ATowerDefenceGame.Projectile)),x=480,y=(ATowerDefenceGame.GameSettings.FloorLevel-320|0)+4|0,this._wizard=new ATowerDefenceGame.Wizard(new Microsoft.Xna.Framework.Vector2.$ctor2(512,y+28|0)),this.BackgroundObjects.Add(this._wizard),this.BackgroundObjects.Add(($t=new ATowerDefenceGame.Tower.$ctor1(0),$t.Position=new Microsoft.Xna.Framework.Rectangle.$ctor2(x,y,64,64),$t)),y=y+64|0;y<ATowerDefenceGame.GameSettings.FloorLevel;y=y+64|0)this.BackgroundObjects.Add(($t=new ATowerDefenceGame.Tower.ctor,$t.Position=new Microsoft.Xna.Framework.Rectangle.$ctor2(x,y,64,64),$t))}},methods:{Update:function(gameTime){var $t,$t1,$t2,projectile,enemy,enemy1;ATowerDefenceGame.InputManager.KeyPressed(Microsoft.Xna.Framework.Input.Keys.Space)&&this.Enemies.Add(new ATowerDefenceGame.EnemyKnight.ctor);ATowerDefenceGame.InputManager.MousePressed()&&this.CreateFireball();ATowerDefenceGame.ILevel.prototype.Update.call(this,gameTime);$t=Bridge.getEnumerator(this.Projectiles);try{while($t.moveNext()){projectile=$t.Current;projectile.Update(gameTime);$t1=Bridge.getEnumerator(this.Enemies);try{while($t1.moveNext())enemy=$t1.Current,enemy.Bounding.Overlaps(projectile.Bounding)&&projectile.Hit(enemy)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}projectile.Destroyed&&this.Projectiles.Remove(projectile)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}$t2=Bridge.getEnumerator(this.Enemies);try{while($t2.moveNext())enemy1=$t2.Current,enemy1.Update(gameTime),enemy1.Dead&&this.Enemies.Remove(enemy1)}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$Dispose()}this.Projectiles.Commit();this.Enemies.Commit()},CreateFireball:function(){var mp=ATowerDefenceGame.InputManager.MousePosition.ToVector2(),spawnCircle=new ATowerDefenceGame.Circle.$ctor1(this._wizard.Position.$clone(),ATowerDefenceGame.GameLevel.ProjectileCircleRadius),pos=spawnCircle.Sample(),dir=Microsoft.Xna.Framework.Vector2.op_Subtraction(mp.$clone(),pos.$clone()),fb;dir.Normalize();fb=new ATowerDefenceGame.Fireball(pos.$clone(),Microsoft.Xna.Framework.Vector2.op_Multiply$1(dir.$clone(),200));this.Projectiles.Add(fb)},BeforeDraw:function(gameTime,spriteBatch){var rectangle=new Microsoft.Xna.Framework.Rectangle.$ctor2(0,0,1,ATowerDefenceGame.GameSettings.BaseHeight),thic=!1;for(rectangle.X=16;rectangle.X<ATowerDefenceGame.GameSettings.BaseWidth;rectangle.X=rectangle.X+16|0)rectangle.Width=thic?2:1,ATowerDefenceGame.Extensions.DrawRectangle(spriteBatch,rectangle.$clone(),Microsoft.Xna.Framework.Color.Gray.$clone()),thic=!thic;for(rectangle=new Microsoft.Xna.Framework.Rectangle.$ctor2(0,0,ATowerDefenceGame.GameSettings.BaseWidth,1),thic=!1,rectangle.Y=16;rectangle.Y<ATowerDefenceGame.GameSettings.BaseHeight;rectangle.Y=rectangle.Y+16|0)rectangle.Height=thic?2:1,ATowerDefenceGame.Extensions.DrawRectangle(spriteBatch,rectangle.$clone(),Microsoft.Xna.Framework.Color.Gray.$clone()),thic=!thic;ATowerDefenceGame.ILevel.prototype.BeforeDraw.call(this,gameTime,spriteBatch)},Draw:function(gameTime,spriteBatch){var $t,$t1,enemy,projectile;spriteBatch.Draw$3(ATowerDefenceGame.GameContent.Texture.Ground,new Microsoft.Xna.Framework.Vector2.$ctor2(0,ATowerDefenceGame.GameSettings.FloorLevel-32|0),Microsoft.Xna.Framework.Color.White.$clone());ATowerDefenceGame.ILevel.prototype.Draw.call(this,gameTime,spriteBatch);$t=Bridge.getEnumerator(this.Enemies);try{while($t.moveNext())enemy=$t.Current,enemy.Draw(gameTime,spriteBatch)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}$t1=Bridge.getEnumerator(this.Projectiles);try{while($t1.moveNext())projectile=$t1.Current,projectile.Draw(gameTime,spriteBatch)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}}}});Bridge.define("ATowerDefenceGame.MenuButton",{inherits:[ATowerDefenceGame.IObject],fields:{Activated:null,Text:null,_textPosition:null,_alpha:0,_size:null,_font:null},ctors:{init:function(){this._textPosition=new Microsoft.Xna.Framework.Vector2;this._size=new Microsoft.Xna.Framework.Rectangle},ctor:function(text,position,bigbutton){bigbutton===void 0&&(bigbutton=!0);this.$initialize();ATowerDefenceGame.IObject.ctor.call(this);this.Text=text;this._font=bigbutton?ATowerDefenceGame.GameContent.Font.TitleFont:ATowerDefenceGame.GameContent.Font.IntroFont;var size=this._font.MeasureString(this.Text);this._textPosition=Microsoft.Xna.Framework.Vector2.op_Subtraction(position.$clone(),Microsoft.Xna.Framework.Vector2.op_Division$1(size.$clone(),2));this._size=new Microsoft.Xna.Framework.Rectangle.$ctor2(Bridge.Int.clip32(this._textPosition.X),Bridge.Int.clip32(this._textPosition.Y),Bridge.Int.clip32(size.X),Bridge.Int.clip32(size.Y));this._alpha=.1}},methods:{Update:function(gameTime){var hover=this._size.Contains(ATowerDefenceGame.InputManager.MousePosition.$clone());this._alpha=hover?.3:.1;hover&&ATowerDefenceGame.InputManager.MousePressed()&&(Bridge.staticEquals(this.Activated,null)?null:this.Activated(this,{}))},Draw:function(gameTime,spriteBatch){spriteBatch.DrawString(this._font,this.Text,Microsoft.Xna.Framework.Vector2.op_Addition(this._textPosition.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(3,3)),Microsoft.Xna.Framework.Color.op_Multiply(Microsoft.Xna.Framework.Color.White.$clone(),this._alpha));spriteBatch.DrawString(this._font,this.Text,Microsoft.Xna.Framework.Vector2.op_Addition(this._textPosition.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(3,0)),Microsoft.Xna.Framework.Color.op_Multiply(Microsoft.Xna.Framework.Color.White.$clone(),this._alpha));spriteBatch.DrawString(this._font,this.Text,Microsoft.Xna.Framework.Vector2.op_Addition(this._textPosition.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(0,3)),Microsoft.Xna.Framework.Color.op_Multiply(Microsoft.Xna.Framework.Color.White.$clone(),this._alpha));spriteBatch.DrawString(this._font,this.Text,this._textPosition.$clone(),Microsoft.Xna.Framework.Color.White.$clone())}}});Bridge.define("ATowerDefenceGame.MenuLevel",{inherits:[ATowerDefenceGame.ILevel],statics:{fields:{TitleText:null},ctors:{init:function(){this.TitleText="A Tower Defence Game"}}},fields:{_titlePosition:null},ctors:{init:function(){this._titlePosition=new Microsoft.Xna.Framework.Vector2},ctor:function(){var measurements,playbutton,fullscreenbutton,quitbutton;this.$initialize();ATowerDefenceGame.ILevel.ctor.call(this);this.BackgroundColor=Microsoft.Xna.Framework.Color.Black.$clone();ATowerDefenceGame.GameSettings.SetCursor(ATowerDefenceGame.CursorType.Pointer);measurements=ATowerDefenceGame.GameContent.Font.TitleFont.MeasureString(ATowerDefenceGame.MenuLevel.TitleText);this._titlePosition=new Microsoft.Xna.Framework.Vector2.$ctor2((ATowerDefenceGame.GameSettings.BaseWidth-measurements.X)/2,40);playbutton=new ATowerDefenceGame.MenuButton("Play",new Microsoft.Xna.Framework.Vector2.$ctor2(512,400));playbutton.Activated=Bridge.fn.combine(playbutton.Activated,function(sender,e){ATowerDefenceGame.LevelManager.LoadLevel(new ATowerDefenceGame.GameLevel)});this.Objects.Add(playbutton);fullscreenbutton=new ATowerDefenceGame.MenuButton("Fullscreen: off",new Microsoft.Xna.Framework.Vector2.$ctor2(256,500),!1);fullscreenbutton.Activated=Bridge.fn.combine(fullscreenbutton.Activated,function(){var fullscreen=!ATowerDefenceGame.GameSettings.GDManager.IsFullScreen;fullscreenbutton.Text="Fullscreen: "+((fullscreen?"on":"off")||"");ATowerDefenceGame.GameSettings.GDManager.IsFullScreen=fullscreen;ATowerDefenceGame.GameSettings.GDManager.ApplyChanges()});this.Objects.Add(fullscreenbutton);quitbutton=new ATowerDefenceGame.MenuButton("Quit",new Microsoft.Xna.Framework.Vector2.$ctor2(768,500),!1);quitbutton.Activated=Bridge.fn.combine(quitbutton.Activated,function(sender,e){ATowerDefenceGame.Game1.Instance.Exit()});this.Objects.Add(quitbutton)}},methods:{Update:function(gameTime){ATowerDefenceGame.ILevel.prototype.Update.call(this,gameTime)},Draw:function(gameTime,spriteBatch){spriteBatch.DrawString(ATowerDefenceGame.GameContent.Font.TitleFont,ATowerDefenceGame.MenuLevel.TitleText,this._titlePosition.$clone(),Microsoft.Xna.Framework.Color.White.$clone());ATowerDefenceGame.ILevel.prototype.Draw.call(this,gameTime,spriteBatch)}}});Bridge.define("ATowerDefenceGame.Tower",{inherits:[ATowerDefenceGame.IObject],statics:{fields:{Towers:null},ctors:{init:function(){this.Towers=new(System.Collections.Generic.List$1(ATowerDefenceGame.Tower).ctor)}},methods:{GetBottomTower:function(){var $t,tower=null,max=0,_tower;$t=Bridge.getEnumerator(ATowerDefenceGame.Tower.Towers);try{while($t.moveNext())_tower=$t.Current,_tower.Position.Y>max&&(tower=_tower,max=_tower.Position.Y)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return tower}}},fields:{Health:0,Position:null,_sourceRectangle:null,_damageTexture:null,_damagePixelsMax:0},ctors:{init:function(){this.Position=new Microsoft.Xna.Framework.Rectangle;this._sourceRectangle=new Microsoft.Xna.Framework.Rectangle},$ctor1:function(index){this.$initialize();ATowerDefenceGame.IObject.ctor.call(this);this._sourceRectangle=new Microsoft.Xna.Framework.Rectangle.$ctor2(0,Bridge.Int.mul(index,32),32,32);ATowerDefenceGame.Tower.Towers.add(this)},ctor:function(){ATowerDefenceGame.Tower.$ctor1.call(this,(ATowerDefenceGame.RngGenerator.GetUInt32()%4|0)+1|0);this.Health=100}},methods:{DealDamage:function(damage){},Draw:function(gameTime,spriteBatch){spriteBatch.Draw$1(ATowerDefenceGame.GameContent.Texture.Tower,this.Position.$clone(),this._sourceRectangle.$clone(),Microsoft.Xna.Framework.Color.White.$clone())}}});Bridge.define("ATowerDefenceGame.Wizard",{inherits:[ATowerDefenceGame.IObject],fields:{Position:null},ctors:{init:function(){this.Position=new Microsoft.Xna.Framework.Vector2},ctor:function(position){this.$initialize();ATowerDefenceGame.IObject.ctor.call(this);this.Position=position.$clone()}},methods:{Draw:function(gameTime,spriteBatch){var drawPos=Microsoft.Xna.Framework.Vector2.op_Subtraction(this.Position.$clone(),new Microsoft.Xna.Framework.Vector2.$ctor2(Bridge.Int.div(ATowerDefenceGame.GameContent.Texture.Wizard.Width,2)|0,ATowerDefenceGame.GameContent.Texture.Wizard.Height));spriteBatch.Draw$4(ATowerDefenceGame.GameContent.Texture.Wizard,drawPos.$clone(),null,Microsoft.Xna.Framework.Color.White.$clone())}}});Bridge.define("ATowerDefenceGame.EnemyKnight",{inherits:[ATowerDefenceGame.Enemy],statics:{fields:{_attackpower:0},ctors:{init:function(){this._attackpower=4}}},fields:{State:0,Rotation:0,_angleChange:0,_movement:null,_effect:0},ctors:{init:function(){this._movement=new Microsoft.Xna.Framework.Vector2},ctor:function(){ATowerDefenceGame.EnemyKnight.$ctor1.call(this,ATowerDefenceGame.RngGenerator.GetBool())},$ctor1:function(left){this.$initialize();ATowerDefenceGame.Enemy.ctor.call(this,100);this.State=ATowerDefenceGame.EnemyState.Walking;this.Origin=new Microsoft.Xna.Framework.Vector2.$ctor2(8,8);this.Radius=8;this.Position=new Microsoft.Xna.Framework.Vector2.$ctor2(left?-40:1064,ATowerDefenceGame.GameSettings.FloorLevel-this.Origin.Y);this.Rotation=0;this._movement=new Microsoft.Xna.Framework.Vector2.$ctor2(50*(left?1:-1),50);this._angleChange=200;this._effect=left?Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally:Microsoft.Xna.Framework.Graphics.SpriteEffects.None}},methods:{Update:function(gameTime){(this.Rotation<-30||this.Rotation>30)&&(this._angleChange*=-1);(this.Position.Y<ATowerDefenceGame.GameSettings.FloorLevel-this.Origin.Y-3||this.Position.Y>ATowerDefenceGame.GameSettings.FloorLevel-this.Origin.Y+3)&&(this._movement.Y*=-1);this.Rotation+=gameTime.ElapsedGameTime.getTotalSeconds()*this._angleChange;this.Position.Y+=gameTime.ElapsedGameTime.getTotalSeconds()*this._movement.Y;this.State===ATowerDefenceGame.EnemyState.Walking?(this.Position.X+=gameTime.ElapsedGameTime.getTotalSeconds()*this._movement.X,Math.abs(this.Position.X-512)<20+this.Origin.X&&(this.State=ATowerDefenceGame.EnemyState.Attacking)):ATowerDefenceGame.Tower.GetBottomTower().DealDamage(ATowerDefenceGame.EnemyKnight._attackpower*gameTime.ElapsedGameTime.getTotalSeconds())},Draw:function(gameTime,spriteBatch){spriteBatch.Draw$5(ATowerDefenceGame.GameContent.Texture.EnemyKnight,this.Position.$clone(),null,Microsoft.Xna.Framework.Color.White.$clone(),Microsoft.Xna.Framework.MathHelper.ToRadians(this.Rotation),this.Origin.$clone(),Microsoft.Xna.Framework.Vector2.One.$clone(),this._effect,0)}}});Bridge.define("ATowerDefenceGame.Fireball",{inherits:[ATowerDefenceGame.Projectile],props:{Origin:{get:function(){return new Microsoft.Xna.Framework.Vector2.$ctor2(24,15.5)}},Radius:{get:function(){return 10}}},ctors:{ctor:function(position,speed){this.$initialize();ATowerDefenceGame.Projectile.ctor.call(this,position,ATowerDefenceGame.GameContent.Texture.Fireball);this.Speed=speed.$clone();this.Damage=50}}})});